use std::time::Instant;
use num_format::{Locale, ToFormattedString};
// Conditionally compile allocation counting logic only when the 'bench' feature is enabled.
#[cfg(feature = "bench")]
use allocation_counter::measure as count_allocations;
use falcon512_rs::{tests::test_utils::verify_distance};

pub fn nist_test_verify_0() {
    let nonce_msg = [51, 179, 192, 117, 7, 228, 32, 23, 72, 73, 77, 131, 43, 110, 226, 166, 201, 59, 255, 155, 14, 227, 67, 181, 80, 209, 248, 90, 61, 13, 224, 215, 4, 198, 209, 120, 66, 149, 19, 9, 216, 28, 77, 141, 115, 79, 203, 251, 234, 222, 61, 63, 138, 3, 159, 170, 42, 44, 153, 87, 232, 53, 173, 85, 178, 46, 117, 191, 87, 187, 85, 106, 200];
    let sig = [7, 101, 132, 61, 30, 70, 13, 23, 165, 39, 210, 188, 164, 5, 189, 85, 187, 199, 218, 9, 168, 198, 32, 190, 10, 244, 167, 103, 217, 219, 150, 184, 15, 85, 228, 102, 103, 103, 81, 234, 171, 167, 185, 59, 134, 215, 17, 50, 218, 160, 235, 55, 103, 130, 185, 238, 227, 117, 25, 206, 16, 253, 211, 63, 233, 242, 147, 18, 195, 29, 135, 54, 32, 109, 22, 92, 244, 197, 40, 170, 61, 220, 1, 120, 69, 225, 240, 221, 91, 10, 68, 255, 150, 28, 66, 216, 116, 169, 85, 51, 229, 180, 56, 152, 47, 82, 76, 169, 84, 216, 117, 51, 191, 190, 66, 198, 63, 242, 171, 199, 122, 52, 199, 157, 181, 90, 153, 23, 27, 188, 183, 44, 132, 42, 101, 48, 175, 47, 117, 63, 12, 52, 172, 99, 47, 159, 30, 121, 73, 240, 191, 108, 103, 102, 91, 39, 114, 42, 136, 87, 214, 38, 182, 255, 26, 19, 109, 146, 58, 57, 244, 6, 155, 116, 119, 255, 148, 110, 82, 71, 166, 98, 119, 145, 212, 155, 89, 237, 201, 226, 82, 90, 134, 14, 110, 152, 40, 209, 143, 100, 169, 241, 114, 34, 232, 22, 106, 2, 69, 56, 89, 187, 218, 11, 129, 134, 216, 201, 146, 139, 181, 113, 228, 20, 100, 1, 215, 67, 14, 34, 89, 4, 103, 58, 210, 28, 202, 197, 76, 20, 108, 36, 138, 29, 214, 154, 182, 73, 30, 144, 29, 109, 113, 177, 82, 21, 91, 233, 125, 224, 87, 243, 145, 106, 63, 27, 66, 115, 48, 140, 41, 178, 244, 217, 105, 113, 103, 185, 6, 129, 177, 88, 62, 217, 48, 167, 30, 153, 4, 103, 222, 163, 104, 19, 75, 236, 238, 189, 89, 127, 155, 236, 146, 46, 129, 111, 27, 5, 112, 215, 40, 244, 174, 4, 100, 193, 247, 151, 101, 127, 135, 164, 229, 45, 205, 202, 235, 146, 114, 102, 46, 166, 109, 124, 108, 216, 120, 27, 49, 175, 85, 90, 217, 63, 95, 101, 231, 88, 22, 203, 141, 195, 6, 187, 103, 229, 146, 181, 38, 27, 172, 167, 197, 9, 98, 158, 162, 175, 138, 187, 128, 203, 168, 158, 229, 53, 183, 109, 253, 156, 203, 190, 59, 244, 143, 43, 200, 170, 52, 178, 110, 17, 3, 41, 16, 83, 245, 203, 141, 227, 164, 90, 250, 90, 118, 223, 139, 33, 34, 237, 44, 130, 251, 207, 34, 89, 41, 13, 65, 161, 79, 134, 177, 47, 53, 245, 212, 151, 98, 179, 76, 255, 19, 238, 126, 66, 237, 236, 112, 32, 29, 127, 55, 195, 51, 22, 40, 143, 163, 7, 142, 54, 229, 129, 8, 134, 92, 60, 254, 38, 61, 86, 54, 146, 4, 61, 236, 198, 47, 52, 38, 248, 96, 97, 40, 91, 123, 27, 51, 111, 86, 255, 65, 187, 101, 233, 205, 109, 155, 146, 253, 144, 248, 100, 170, 28, 146, 60, 184, 199, 85, 245, 205, 225, 119, 13, 134, 37, 149, 66, 113, 73, 215, 114, 26, 170, 181, 209, 148, 174, 169, 172, 222, 202, 21, 190, 67, 203, 166, 166, 43, 90, 51, 144, 158, 159, 196, 218, 28, 88, 20, 251, 215, 205, 106, 47, 165, 114, 227, 24, 180, 44, 108, 49, 145, 64, 184, 110, 102, 57, 37, 128, 161, 26, 43, 67, 31, 68, 193, 249, 39, 14, 79, 123, 36, 144, 243, 179, 37, 169, 151, 122, 113, 165, 117, 145, 86, 54, 99, 91, 153, 105, 219, 214, 210, 32, 178, 76, 61, 153, 206, 187, 189, 131, 75, 136, 34, 43, 208, 140, 58, 190, 18, 78, 128];
    let pk_ntt_fmt = [2967, 6893, 10256, 4032, 12035, 8280, 6629, 10074, 10662, 3179, 2548, 250, 10744, 4943, 8274, 4605, 1556, 5076, 6013, 2414, 1175, 11900, 11611, 1342, 5659, 12077, 10011, 5458, 6410, 528, 11141, 1139, 1834, 11085, 441, 1476, 3483, 6491, 747, 2941, 1854, 4678, 5157, 4794, 6216, 9959, 2495, 4788, 9054, 3799, 5594, 1883, 8026, 350, 9629, 8176, 3034, 11179, 7720, 10513, 2638, 5569, 3127, 4195, 5772, 6649, 2234, 5161, 11807, 4409, 9474, 5554, 170, 7313, 3645, 1281, 7324, 6331, 5233, 4724, 8973, 2539, 4593, 426, 11374, 12214, 12274, 3386, 721, 2333, 3656, 10625, 1041, 8708, 7400, 2280, 6609, 11383, 5487, 6656, 12248, 10452, 1463, 2604, 4950, 653, 3196, 8839, 3938, 8479, 1736, 11523, 6342, 3381, 943, 1501, 2152, 6689, 7196, 9281, 4391, 4174, 196, 3215, 1341, 9374, 6136, 8428, 7947, 1632, 5718, 9528, 11408, 9153, 7192, 1884, 10690, 10990, 6146, 583, 1925, 3111, 2478, 5396, 7989, 6740, 10921, 1752, 8601, 3347, 9717, 8937, 6227, 7484, 6680, 8117, 4053, 45, 3143, 10998, 6867, 6112, 8405, 1006, 9481, 7195, 2267, 4812, 6575, 9177, 3910, 10305, 10748, 8720, 8236, 867, 455, 10395, 1188, 1065, 3337, 5412, 847, 4862, 7337, 9147, 8856, 8625, 1409, 3840, 11192, 11600, 4472, 9409, 451, 7279, 786, 8219, 936, 4218, 199, 4789, 11959, 8775, 7384, 4030, 5925, 5926, 3964, 3149, 9546, 5655, 6028, 6327, 5215, 4747, 10448, 11286, 11192, 6185, 11843, 7824, 6081, 7278, 11963, 487, 5534, 3135, 11514, 2491, 2902, 9058, 2329, 5926, 3650, 2551, 6615, 4799, 2959, 8134, 8502, 2566, 1024, 8403, 3775, 8565, 6468, 9185, 1197, 7291, 3101, 10802, 3665, 4917, 5667, 3790, 3846, 2904, 9056, 6724, 1509, 10591, 5035, 10040, 2634, 1410, 11544, 2733, 6564, 8464, 4582, 3991, 6145, 995, 11341, 11541, 5571, 39, 12104, 10959, 10165, 996, 6311, 11612, 3912, 6643, 10314, 3219, 6650, 449, 8337, 2935, 11015, 6853, 8876, 1470, 3008, 9482, 2791, 4501, 4287, 4757, 7532, 4360, 11222, 6878, 9033, 4366, 5056, 4157, 5269, 2937, 11842, 1468, 11676, 1032, 7925, 11684, 2267, 109, 10761, 8019, 2328, 10187, 2942, 9985, 12280, 4617, 11676, 880, 11114, 12142, 7826, 252, 7291, 11915, 1529, 6695, 7703, 10188, 6458, 9121, 8720, 9981, 5562, 7745, 4134, 6072, 4365, 5649, 10341, 4513, 8093, 11346, 1849, 4513, 7904, 7219, 12273, 6405, 10262, 5279, 2312, 2935, 4843, 10084, 8699, 8651, 7721, 8890, 3859, 4204, 10541, 3072, 7596, 11091, 11248, 4748, 7272, 5607, 9993, 6222, 4276, 1591, 2112, 7602, 7576, 9645, 2010, 1681, 9620, 5535, 6170, 7075, 6296, 6948, 10048, 9569, 10085, 11624, 10058, 4357, 237, 5792, 6841, 7610, 10192, 1279, 4943, 6441, 10117, 2854, 2099, 9324, 4734, 7723, 9617, 832, 11601, 8267, 9281, 158, 10935, 8008, 857, 4420, 1191, 5204, 8792, 10045, 11675, 10917, 10026, 2313, 716, 8521, 10349, 10961, 6561, 1579, 10776, 6208, 6725, 9222, 352, 2331, 11874, 10737, 10727, 7046, 2155, 6644, 1689, 21, 9687, 9740, 5677, 8295, 7213, 5354, 8128, 835, 1058, 9152, 5382, 11395, 4750, 9347, 10055, 6816, 530, 5639, 5589, 6972, 936, 6596, 2779, 11977, 11215, 149, 7769, 786, 4048, 7748, 11088, 7297, 306, 7285, 8829, 545, 4828, 1068, 8585, 10805, 7151, 7476, 10481, 8077, 8057, 5454, 8785, 5380, 8420, 3192, 6268, 1507, 2403, 11955, 10041, 4118, 6005, 3728];

    let res = verify_distance(&nonce_msg, &sig, &pk_ntt_fmt);

    if res != 28308410 {
        panic!("Verify failure");
    };
}

pub fn nist_test_verify_99() {
    let nonce_msg = [43, 50, 240, 188, 119, 230, 82, 249, 242, 40, 186, 181, 19, 207, 132, 59, 110, 35, 200, 88, 12, 184, 141, 38, 125, 12, 236, 33, 170, 180, 68, 9, 158, 213, 48, 128, 240, 142, 125, 207, 210, 26, 107, 179, 162, 53, 104, 5, 230, 120, 103, 60, 69, 251, 5, 95, 197, 38, 110, 63, 105, 42, 249, 147, 90, 234, 48, 127, 20, 165, 196, 27, 151, 153, 102, 165, 223, 228, 46, 191, 237, 20, 135, 228, 130, 43, 116, 171, 90, 242, 137, 149, 224, 133, 236, 128, 7, 236, 164, 151, 124, 99, 238, 82, 153, 254, 198, 61, 204, 188, 66, 238, 172, 171, 72, 142, 87, 66, 73, 233, 216, 86, 20, 103, 80, 173, 151, 200, 164, 67, 72, 94, 193, 197, 130, 11, 235, 9, 100, 100, 0, 16, 246, 64, 113, 64, 121, 30, 116, 104, 77, 187, 145, 5, 46, 45, 139, 239, 123, 220, 215, 139, 46, 192, 60, 151, 165, 50, 149, 214, 131, 189, 190, 50, 167, 13, 193, 154, 47, 117, 184, 97, 58, 234, 150, 22, 174, 14, 40, 1, 121, 73, 40, 32, 247, 63, 183, 250, 65, 33, 230, 115, 251, 92, 50, 143, 65, 182, 127, 248, 255, 167, 174, 230, 86, 74, 218, 186, 4, 109, 110, 29, 106, 161, 63, 178, 73, 101, 57, 15, 130, 146, 70, 223, 168, 118, 56, 81, 64, 80, 117, 247, 108, 249, 76, 102, 255, 195, 48, 130, 20, 223, 9, 96, 198, 73, 170, 237, 194, 41, 38, 206, 147, 87, 211, 135, 95, 139, 113, 214, 141, 117, 153, 154, 163, 102, 60, 48, 169, 237, 240, 114, 40, 191, 125, 255, 73, 236, 30, 108, 122, 51, 210, 5, 53, 151, 0, 59, 130, 57, 46, 130, 110, 189, 112, 27, 76, 152, 26, 170, 201, 149, 28, 121, 224, 143, 89, 44, 44, 6, 55, 200, 229, 167, 249, 220, 218, 89, 158, 133, 156, 49, 125, 72, 136, 180, 9, 137, 146, 224, 226, 217, 121, 228, 28, 112, 54, 134, 213, 119, 229, 186, 96, 1, 236, 79, 88, 113, 64, 113, 18, 147, 214, 100, 150, 54, 50, 248, 126, 160, 70, 30, 14, 12, 94, 157, 141, 41, 47, 180, 9, 249, 249, 171, 23, 46, 225, 127, 200, 175, 171, 173, 6, 228, 43, 67, 124, 226, 41, 36, 235, 93, 189, 58, 128, 160, 105, 98, 243, 179, 121, 70, 37, 159, 156, 117, 162, 51, 203, 43, 74, 189, 197, 205, 27, 100, 143, 174, 177, 190, 134, 48, 219, 64, 209, 81, 184, 251, 166, 147, 223, 44, 91, 220, 170, 20, 220, 71, 131, 244, 80, 182, 188, 64, 117, 21, 206, 235, 197, 201, 164, 123, 209, 161, 65, 56, 79, 11, 89, 108, 171, 17, 53, 192, 117, 101, 28, 186, 152, 156, 25, 15, 49, 113, 220, 29, 114, 51, 14, 218, 160, 22, 86, 129, 60, 75, 120, 17, 113, 80, 96, 176, 35, 252, 66, 103, 69, 195, 1, 178, 169, 30, 13, 8, 237, 59, 222, 212, 56, 196, 206, 103, 153, 195, 95, 57, 129, 200, 130, 160, 189, 228, 162, 254, 235, 26, 82, 202, 250, 71, 176, 196, 133, 88, 252, 67, 249, 143, 224, 143, 3, 167, 17, 40, 54, 43, 182, 251, 157, 166, 162, 34, 73, 244, 212, 53, 42, 231, 211, 218, 232, 93, 228, 151, 226, 65, 30, 173, 207, 229, 191, 26, 60, 7, 92, 69, 129, 30, 0, 151, 236, 234, 37, 95, 225, 91, 216, 50, 31, 232, 181, 70, 168, 202, 207, 184, 153, 238, 207, 84, 25, 219, 54, 60, 117, 103, 194, 254, 115, 96, 179, 109, 225, 70, 116, 245, 0, 163, 29, 62, 236, 113, 69, 26, 124, 13, 85, 118, 168, 147, 156, 15, 109, 77, 159, 47, 3, 243, 197, 22, 206, 37, 206, 115, 171, 179, 92, 115, 170, 148, 246, 174, 250, 230, 173, 135, 5, 45, 107, 25, 95, 164, 53, 134, 129, 127, 91, 185, 116, 170, 231, 241, 184, 96, 137, 34, 65, 26, 165, 176, 215, 213, 116, 1, 108, 189, 61, 237, 19, 57, 86, 35, 71, 10, 16, 143, 160, 225, 211, 249, 250, 167, 225, 229, 3, 24, 67, 242, 162, 61, 188, 232, 177, 150, 49, 82, 144, 222, 165, 121, 94, 65, 21, 213, 61, 197, 112, 164, 68, 6, 76, 250, 60, 148, 87, 219, 243, 238, 50, 59, 25, 102, 236, 210, 39, 12, 50, 145, 15, 143, 67, 5, 34, 71, 18, 88, 161, 241, 149, 90, 110, 29, 216, 200, 78, 217, 165, 102, 73, 155, 248, 86, 40, 97, 83, 81, 171, 232, 75, 64, 20, 33, 218, 44, 250, 245, 117, 226, 100, 76, 147, 4, 192, 117, 236, 252, 55, 64, 102, 206, 199, 19, 250, 76, 13, 137, 4, 54, 137, 251, 197, 159, 245, 75, 143, 151, 238, 10, 59, 9, 137, 188, 94, 78, 248, 60, 201, 131, 62, 117, 188, 139, 103, 187, 94, 227, 192, 110, 161, 86, 97, 28, 218, 149, 166, 112, 36, 22, 128, 117, 48, 234, 32, 110, 216, 152, 53, 210, 8, 5, 234, 152, 139, 25, 88, 86, 156, 223, 127, 128, 153, 150, 33, 77, 173, 171, 78, 32, 189, 68, 145, 126, 52, 16, 236, 107, 234, 201, 143, 234, 7, 247, 100, 232, 91, 102, 174, 213, 225, 124, 246, 117, 210, 237, 142, 99, 219, 114, 143, 231, 81, 88, 203, 49, 119, 158, 49, 55, 150, 72, 180, 61, 104, 204, 255, 55, 128, 133, 76, 240, 53, 53, 197, 113, 34, 1, 148, 86, 231, 60, 240, 103, 105, 191, 31, 191, 85, 133, 66, 36, 28, 230, 101, 189, 16, 249, 33, 130, 133, 83, 88, 94, 12, 246, 100, 205, 198, 22, 15, 156, 71, 250, 83, 48, 89, 27, 116, 25, 79, 71, 22, 5, 108, 168, 57, 147, 239, 236, 74, 82, 219, 154, 31, 189, 59, 47, 80, 74, 193, 150, 103, 50, 81, 103, 64, 115, 117, 182, 215, 222, 115, 159, 7, 148, 123, 81, 28, 141, 71, 87, 68, 229, 194, 157, 110, 40, 106, 55, 241, 255, 131, 23, 189, 1, 120, 240, 227, 6, 163, 143, 166, 231, 95, 74, 128, 66, 127, 235, 44, 145, 35, 93, 62, 127, 32, 216, 16, 28, 252, 3, 187, 115, 244, 78, 245, 154, 243, 82, 110, 154, 252, 88, 0, 39, 161, 218, 222, 55, 101, 66, 56, 184, 236, 122, 240, 16, 82, 72, 254, 48, 120, 74, 136, 183, 46, 17, 252, 27, 216, 7, 228, 122, 52, 155, 210, 144, 117, 190, 251, 178, 151, 48, 239, 142, 133, 227, 171, 213, 16, 85, 89, 186, 206, 231, 74, 162, 125, 144, 211, 96, 168, 214, 41, 219, 236, 149, 235, 52, 199, 247, 202, 32, 9, 111, 247, 181, 33, 228, 13, 57, 68, 169, 117, 67, 104, 150, 243, 114, 238, 171, 107, 134, 21, 235, 145, 105, 121, 101, 187, 249, 85, 119, 157, 211, 4, 127, 126, 59, 240, 41, 227, 80, 154, 87, 128, 36, 116, 69, 214, 34, 61, 8, 90, 251, 66, 145, 217, 118, 239, 173, 196, 30, 66, 220, 44, 7, 40, 209, 143, 97, 85, 101, 74, 51, 47, 236, 114, 235, 106, 239, 139, 146, 193, 209, 119, 227, 220, 40, 195, 25, 113, 188, 175, 247, 109, 222, 191, 217, 88, 139, 194, 68, 177, 22, 212, 9, 229, 141, 197, 173, 161, 100, 134, 99, 214, 3, 196, 127, 174, 184, 20, 170, 167, 235, 155, 98, 100, 53, 111, 146, 108, 24, 185, 53, 123, 244, 38, 184, 157, 220, 142, 185, 23, 126, 206, 181, 198, 205, 198, 77, 216, 254, 183, 179, 38, 188, 27, 168, 155, 217, 3, 82, 53, 218, 14, 100, 78, 249, 89, 197, 141, 217, 123, 136, 213, 199, 73, 179, 105, 49, 172, 38, 148, 198, 113, 81, 219, 8, 148, 101, 46, 153, 37, 66, 34, 211, 124, 239, 233, 226, 123, 61, 214, 99, 161, 82, 219, 226, 154, 54, 57, 175, 228, 47, 69, 120, 147, 112, 118, 24, 5, 99, 170, 214, 173, 115, 146, 85, 234, 1, 42, 23, 210, 165, 102, 39, 216, 76, 68, 251, 171, 38, 29, 57, 42, 150, 108, 254, 25, 39, 135, 153, 207, 22, 52, 212, 35, 132, 50, 60, 73, 97, 144, 212, 185, 251, 102, 38, 148, 227, 136, 126, 166, 106, 185, 232, 177, 149, 72, 140, 141, 202, 71, 200, 188, 4, 36, 36, 119, 89, 19, 124, 251, 248, 109, 237, 195, 100, 25, 4, 203, 111, 172, 187, 48, 169, 250, 132, 172, 246, 154, 103, 180, 175, 223, 76, 42, 164, 32, 252, 13, 144, 206, 250, 13, 251, 188, 211, 7, 45, 159, 119, 47, 214, 5, 142, 43, 240, 226, 81, 190, 147, 176, 13, 196, 55, 101, 181, 61, 181, 27, 34, 241, 45, 62, 208, 204, 86, 85, 228, 174, 189, 157, 146, 63, 153, 164, 62, 68, 97, 220, 245, 153, 32, 48, 230, 106, 28, 220, 58, 101, 85, 141, 155, 179, 163, 151, 136, 217, 35, 40, 56, 125, 20, 72, 80, 221, 55, 6, 253, 122, 7, 158, 61, 35, 152, 245, 66, 249, 26, 138, 170, 191, 12, 80, 104, 219, 175, 31, 204, 81, 96, 57, 138, 190, 207, 116, 136, 75, 235, 4, 243, 163, 234, 56, 187, 184, 13, 121, 143, 89, 129, 179, 242, 219, 108, 123, 51, 248, 103, 183, 220, 6, 164, 65, 126, 48, 249, 76, 219, 79, 82, 58, 238, 160, 190, 18, 189, 117, 170, 237, 87, 82, 13, 176, 212, 180, 240, 19, 190, 58, 29, 199, 174, 92, 88, 253, 29, 233, 99, 127, 125, 130, 246, 151, 183, 233, 45, 164, 39, 167, 143, 238, 198, 165, 192, 37, 94, 181, 122, 67, 222, 166, 206, 188, 136, 5, 188, 4, 224, 79, 231, 137, 226, 34, 177, 226, 100, 45, 38, 237, 193, 79, 179, 110, 204, 96, 146, 179, 6, 14, 69, 238, 214, 197, 179, 93, 232, 116, 31, 114, 147, 57, 48, 236, 189, 115, 56, 207, 57, 71, 65, 34, 53, 115, 101, 112, 12, 181, 12, 94, 177, 118, 251, 146, 129, 79, 167, 244, 3, 37, 112, 204, 238, 107, 133, 146, 54, 173, 93, 165, 241, 115, 1, 41, 237, 199, 190, 33, 139, 169, 135, 70, 32, 246, 240, 235, 196, 94, 11, 214, 34, 248, 253, 26, 230, 151, 73, 148, 175, 149, 198, 81, 158, 193, 196, 102, 80, 192, 115, 209, 148, 250, 110, 188, 98, 244, 5, 246, 58, 52, 22, 120, 42, 71, 135, 44, 125, 119, 214, 72, 208, 161, 200, 2, 255, 223, 222, 95, 220, 17, 44, 148, 207, 198, 143, 64, 24, 137, 239, 197, 34, 254, 72, 143, 219, 83, 132, 192, 217, 49, 71, 171, 101, 135, 101, 157, 147, 111, 152, 236, 251, 205, 207, 191, 139, 53, 45, 96, 95, 24, 200, 85, 226, 85, 151, 67, 237, 151, 153, 28, 93, 80, 223, 68, 167, 185, 41, 48, 56, 53, 101, 74, 57, 85, 171, 197, 190, 230, 50, 116, 0, 167, 204, 206, 70, 11, 49, 141, 139, 94, 206, 91, 18, 246, 6, 173, 179, 215, 181, 237, 89, 86, 59, 142, 103, 94, 120, 2, 154, 171, 194, 52, 68, 44, 36, 99, 37, 111, 224, 43, 4, 245, 86, 218, 53, 196, 97, 93, 20, 169, 244, 239, 241, 125, 176, 219, 129, 222, 75, 221, 137, 79, 102, 40, 161, 32, 190, 45, 76, 243, 225, 244, 109, 83, 129, 120, 153, 101, 112, 53, 167, 97, 55, 226, 60, 11, 14, 141, 221, 41, 70, 93, 127, 21, 98, 143, 212, 53, 230, 202, 172, 164, 25, 79, 219, 248, 95, 220, 195, 29, 93, 175, 203, 82, 86, 139, 124, 12, 251, 231, 19, 188, 133, 250, 66, 75, 163, 171, 225, 73, 228, 3, 95, 200, 104, 7, 168, 184, 118, 210, 22, 59, 68, 124, 173, 94, 192, 230, 239, 56, 161, 213, 145, 175, 180, 98, 103, 249, 219, 241, 66, 202, 177, 202, 193, 247, 59, 235, 162, 18, 153, 47, 198, 212, 100, 126, 193, 120, 72, 209, 173, 187, 25, 1, 39, 122, 80, 120, 221, 114, 217, 201, 24, 78, 137, 60, 8, 6, 233, 180, 175, 240, 168, 36, 103, 13, 67, 134, 32, 242, 167, 232, 210, 150, 91, 97, 157, 41, 30, 88, 36, 192, 20, 252, 136, 138, 54, 251, 190, 23, 53, 100, 49, 240, 3, 144, 56, 249, 180, 151, 144, 42, 237, 150, 159, 156, 72, 131, 144, 183, 8, 119, 99, 99, 142, 151, 104, 1, 18, 123, 175, 31, 83, 128, 60, 77, 201, 100, 159, 14, 232, 93, 103, 178, 57, 226, 189, 175, 178, 189, 117, 241, 209, 218, 34, 165, 111, 179, 175, 16, 169, 221, 231, 173, 48, 108, 74, 248, 104, 16, 41, 49, 108, 14, 25, 73, 34, 142, 107, 245, 173, 249, 66, 241, 192, 239, 146, 178, 188, 188, 12, 112, 212, 158, 88, 8, 133, 20, 68, 36, 10, 120, 177, 77, 33, 181, 79, 102, 39, 20, 130, 244, 155, 133, 245, 24, 11, 38, 128, 80, 50, 115, 104, 73, 108, 250, 139, 84, 236, 185, 126, 230, 210, 142, 183, 74, 55, 66, 246, 133, 131, 218, 4, 104, 9, 0, 44, 34, 247, 179, 31, 188, 5, 102, 150, 159, 154, 21, 205, 202, 137, 44, 75, 235, 16, 26, 42, 195, 82, 108, 118, 233, 211, 9, 130, 201, 180, 137, 52, 80, 253, 236, 64, 1, 210, 67, 24, 40, 210, 77, 139, 26, 103, 223, 128, 226, 225, 14, 210, 234, 141, 114, 50, 39, 5, 92, 72, 0, 102, 101, 247, 218, 142, 3, 46, 253, 199, 11, 199, 238, 178, 179, 105, 181, 81, 250, 197, 66, 173, 109, 241, 162, 49, 7, 226, 179, 192, 227, 204, 172, 194, 95, 38, 64, 76, 8, 92, 191, 86, 229, 45, 53, 215, 148, 141, 185, 253, 166, 223, 194, 71, 9, 153, 71, 25, 216, 206, 212, 26, 44, 201, 179, 196, 178, 190, 240, 150, 124, 183, 24, 97, 207, 14, 106, 234, 155, 236, 147, 149, 114, 106, 160, 226, 241, 167, 36, 126, 208, 246, 3, 142, 61, 244, 191, 86, 103, 134, 7, 53, 144, 220, 249, 127, 143, 10, 153, 101, 141, 143, 99, 10, 45, 19, 12, 70, 207, 77, 38, 198, 105, 54, 13, 15, 112, 183, 95, 144, 76, 159, 146, 58, 178, 133, 213, 219, 18, 159, 108, 37, 173, 33, 249, 226, 106, 200, 68, 208, 122, 142, 237, 134, 196, 226, 36, 235, 252, 91, 63, 114, 13, 111, 148, 176, 160, 27, 20, 51, 196, 107, 64, 207, 132, 232, 15, 122, 106, 250, 123, 184, 249, 172, 248, 24, 173, 60, 171, 45, 221, 105, 4, 192, 103, 190, 164, 241, 254, 121, 184, 60, 176, 170, 143, 199, 91, 107, 9, 107, 173, 111, 233, 74, 191, 212, 143, 142, 252, 15, 43, 154, 2, 235, 218, 143, 219, 219, 225, 199, 127, 24, 84, 237, 186, 24, 170, 231, 243, 28, 237, 156, 211, 76, 27, 53, 81, 8, 223, 24, 168, 149, 57, 50, 247, 85, 74, 240, 91, 32, 58, 150, 169, 187, 147, 224, 239, 245, 29, 127, 147, 181, 110, 53, 21, 98, 207, 133, 162, 211, 94, 174, 44, 36, 39, 184, 154, 134, 98, 161, 199, 35, 212, 241, 78, 110, 175, 219, 214, 54, 194, 187, 122, 222, 41, 193, 166, 188, 138, 70, 55, 52, 200, 8, 190, 198, 139, 30, 154, 49, 175, 110, 41, 180, 18, 241, 203, 140, 144, 169, 145, 26, 197, 195, 234, 113, 228, 97, 19, 210, 215, 177, 174, 45, 136, 2, 176, 106, 119, 15, 208, 233, 228, 101, 40, 149, 228, 33, 129, 173, 9, 187, 84, 30, 148, 147, 242, 88, 113, 27, 183, 190, 221, 62, 124, 168, 184, 206, 135, 86, 105, 207, 128, 166, 136, 14, 202, 63, 19, 128, 13, 231, 1, 30, 166, 127, 68, 62, 80, 92, 79, 180, 85, 96, 138, 229, 134, 249, 34, 179, 200, 63, 211, 59, 48, 107, 222, 219, 134, 34, 60, 51, 227, 170, 101, 237, 201, 60, 188, 243, 160, 58, 218, 249, 243, 40, 153, 121, 81, 213, 154, 146, 0, 192, 186, 38, 24, 227, 89, 106, 241, 118, 180, 49, 34, 206, 220, 82, 177, 224, 6, 234, 109, 18, 220, 35, 106, 111, 205, 124, 196, 104, 37, 242, 239, 126, 215, 22, 131, 167, 49, 215, 70, 255, 242, 254, 84, 224, 179, 146, 168, 203, 250, 56, 135, 49, 150, 187, 43, 131, 93, 202, 124, 183, 195, 237, 154, 0, 76, 122, 50, 155, 151, 52, 161, 17, 116, 75, 218, 205, 182, 105, 230, 158, 157, 241, 229, 47, 7, 197, 19, 227, 117, 42, 12, 205, 129, 215, 221, 196, 166, 72, 104, 183, 187, 43, 187, 210, 9, 83, 115, 72, 5, 34, 190, 16, 97, 82, 72, 161, 121, 220, 182, 29, 172, 144, 247, 250, 95, 169, 184, 79, 25, 10, 156, 98, 181, 255, 156, 212, 115, 169, 64, 240, 62, 113, 7, 21, 125, 126, 182, 10, 241, 227, 227, 132, 255, 232, 166, 125, 203, 35, 137, 179, 176, 250, 183, 199, 137, 207, 16, 12, 169, 92, 214, 168, 84, 66, 203, 154, 44, 36, 63, 185, 212, 84, 178, 11, 174, 87, 98, 215, 43, 143, 231, 155, 77, 248, 17, 99, 214, 29, 228, 87, 140, 249, 118, 153, 45, 139, 153, 137, 252, 104, 8, 159, 129, 31, 83, 219, 30, 16, 146, 182, 2, 32, 85, 40, 118, 184, 24, 190, 169, 129, 87, 24, 152, 205, 106, 183, 181, 241, 60, 70, 176, 160, 118, 82, 110, 50, 65, 214, 80, 20, 248, 85, 239, 215, 189, 224, 138, 217, 31, 37, 157, 203, 100, 233, 78, 195, 218, 217, 120, 17, 235, 2, 78, 225, 211, 65, 82, 29, 201, 42, 229, 233, 60, 115, 66, 32, 136, 151, 111, 45, 39, 214, 78, 29, 25, 59, 149, 94, 103, 54, 173, 43, 204, 243, 193, 165, 61, 89, 5, 118, 67, 74, 203, 192, 182, 135, 242, 127, 37, 95, 239, 53, 78, 104, 172, 164, 113, 96, 239, 167, 18, 111, 144, 142, 8, 228, 84, 140, 17, 84, 109, 156, 65, 45, 104, 95, 168, 77, 46, 180, 220, 178, 189, 252, 72, 226, 250, 128, 35, 84, 129, 152, 235, 176, 114, 164, 128, 68, 244, 57, 17, 67, 227, 190, 244, 255, 144, 102, 164, 176, 208, 58, 220, 130, 104, 25, 214, 117, 136, 186, 132, 249, 157, 162, 116, 36, 16, 54, 82, 172, 192, 57, 221, 211, 181, 103, 133, 28, 215, 142, 65, 23, 168, 185, 58, 254, 1, 252, 142, 235, 218, 161, 172, 184, 186, 157, 9, 87, 137, 231, 107, 157, 90, 185, 238, 23, 122, 21, 214, 102, 239, 23, 31, 225, 212, 189, 204, 254, 46, 88, 206, 102, 155, 86, 31, 99, 2, 140, 108, 226, 109, 181, 200, 24, 47, 224, 72, 104, 11, 23, 92, 122, 180, 7, 33, 95, 243, 167, 128, 28, 149, 13, 80, 152, 103, 171, 27, 11, 239, 137, 179, 227, 138, 56, 121, 21, 34, 94, 222, 118, 249, 26, 173, 21, 168, 93, 140, 70, 239, 213, 136, 187, 59, 170, 203, 197, 44, 3, 98, 17, 81, 36, 115, 66, 15, 63, 6, 31, 95, 83, 233, 53, 61, 224, 120, 4, 37, 116, 90, 118, 67, 155, 56, 17, 81, 28, 134, 202, 80, 50, 81, 242, 65, 19, 56, 78, 26, 36, 169, 54, 117, 54, 231, 150, 206, 8, 184, 150, 245, 114, 72, 154, 35, 57, 232, 42, 133, 108];
    let sig = [89, 86, 228, 59, 41, 186, 20, 193, 153, 82, 177, 6, 89, 217, 36, 171, 225, 6, 116, 232, 41, 143, 61, 4, 121, 149, 55, 175, 143, 138, 250, 177, 13, 26, 88, 50, 179, 24, 14, 211, 30, 192, 44, 155, 24, 26, 57, 24, 181, 39, 16, 23, 229, 132, 49, 244, 6, 174, 174, 95, 165, 145, 154, 182, 134, 65, 178, 161, 241, 109, 233, 19, 218, 147, 42, 147, 53, 163, 105, 215, 74, 109, 184, 101, 85, 90, 248, 96, 255, 62, 170, 21, 25, 163, 253, 230, 158, 59, 12, 253, 140, 89, 6, 25, 41, 198, 39, 233, 141, 214, 123, 75, 179, 176, 214, 228, 195, 215, 28, 140, 52, 126, 162, 180, 143, 208, 49, 254, 200, 155, 51, 164, 57, 123, 44, 91, 185, 92, 49, 212, 62, 181, 161, 211, 224, 74, 116, 126, 55, 59, 16, 187, 217, 136, 218, 168, 187, 66, 25, 54, 92, 104, 54, 108, 254, 172, 226, 77, 172, 69, 0, 249, 70, 123, 21, 188, 190, 110, 241, 113, 214, 254, 7, 59, 47, 43, 224, 205, 224, 234, 127, 133, 171, 131, 202, 41, 18, 172, 174, 97, 147, 85, 23, 138, 219, 223, 252, 154, 32, 232, 139, 118, 200, 200, 40, 237, 87, 160, 110, 161, 139, 249, 65, 53, 175, 108, 185, 153, 178, 251, 218, 69, 49, 44, 138, 228, 46, 59, 42, 220, 24, 202, 177, 83, 6, 179, 104, 136, 245, 108, 209, 229, 127, 135, 26, 186, 96, 84, 142, 43, 221, 130, 73, 220, 159, 237, 230, 19, 238, 194, 71, 24, 49, 204, 100, 91, 183, 212, 95, 226, 67, 61, 80, 112, 108, 46, 76, 64, 203, 61, 79, 60, 36, 179, 210, 248, 135, 37, 104, 152, 123, 142, 125, 82, 70, 246, 244, 28, 56, 211, 217, 238, 118, 217, 104, 70, 193, 41, 232, 88, 98, 93, 143, 247, 190, 3, 25, 102, 32, 132, 71, 69, 163, 229, 85, 188, 115, 100, 186, 210, 154, 223, 216, 54, 243, 84, 215, 45, 211, 21, 54, 94, 220, 52, 41, 140, 226, 72, 184, 239, 49, 20, 12, 62, 235, 227, 140, 155, 66, 96, 141, 28, 126, 107, 186, 104, 246, 78, 102, 158, 202, 201, 196, 227, 78, 142, 191, 179, 237, 151, 20, 93, 163, 94, 132, 187, 16, 212, 83, 45, 154, 198, 179, 26, 148, 29, 36, 221, 34, 73, 222, 52, 172, 77, 168, 197, 13, 112, 234, 91, 57, 67, 114, 203, 54, 82, 244, 164, 201, 168, 43, 41, 5, 35, 167, 214, 33, 204, 48, 36, 178, 40, 155, 174, 207, 163, 255, 47, 166, 36, 173, 124, 41, 20, 202, 213, 150, 182, 117, 172, 240, 231, 107, 116, 212, 184, 41, 184, 167, 27, 243, 229, 99, 211, 246, 72, 144, 234, 230, 222, 4, 48, 185, 244, 169, 189, 243, 220, 160, 164, 59, 185, 18, 246, 135, 104, 99, 189, 247, 147, 249, 227, 250, 65, 144, 214, 7, 247, 23, 218, 33, 230, 122, 63, 246, 167, 55, 216, 92, 186, 18, 248, 161, 38, 53, 35, 130, 35, 247, 204, 195, 207, 204, 41, 87, 220, 123, 110, 177, 36, 68, 67, 55, 12, 79, 147, 38, 35, 35, 26, 48, 136, 46, 199, 213, 207, 100, 140, 239, 97, 206, 183, 55, 171, 205, 138, 127, 78, 113, 105, 228, 194, 183, 56, 159, 170, 104, 250, 164, 134, 214, 36, 173, 27, 59, 226, 139, 54, 195, 251, 184, 78, 236, 49, 101, 210, 6, 177, 219, 19, 56, 254, 134, 177, 4, 238, 186, 123, 150, 71, 123, 220, 64];
    let pk_ntt_fmt = [11675, 10507, 359, 5172, 12074, 6948, 6947, 10379, 5798, 11188, 8271, 4887, 11494, 3619, 10003, 308, 3888, 391, 11218, 5004, 811, 2158, 7319, 8607, 11259, 14, 10303, 5846, 9891, 937, 11202, 333, 4641, 2333, 8752, 4580, 8835, 4724, 3649, 7488, 1026, 10499, 8240, 706, 9171, 4608, 2635, 348, 6392, 12197, 2904, 1983, 7635, 1969, 5623, 10263, 622, 512, 8144, 2288, 2208, 4756, 2456, 2150, 6825, 10059, 5180, 4035, 6200, 1515, 2972, 10578, 5477, 367, 6279, 2176, 11157, 6558, 8207, 10529, 1520, 10575, 9452, 6855, 4235, 10384, 11664, 4666, 1729, 9778, 458, 3851, 6542, 3357, 5301, 2688, 12270, 5553, 9427, 7644, 11993, 5521, 9284, 9917, 4617, 11211, 8381, 478, 3728, 6211, 10307, 10371, 6328, 1441, 3797, 1157, 8841, 8512, 9744, 10396, 2065, 7258, 985, 10977, 3829, 5238, 3649, 3775, 4736, 8426, 5139, 4090, 6878, 211, 8171, 2118, 7313, 1368, 8337, 9353, 7111, 4126, 4768, 9025, 7968, 5223, 3084, 10554, 16, 9816, 11904, 5983, 1619, 509, 2951, 2929, 7372, 4919, 7872, 3733, 12253, 8851, 1071, 6928, 9943, 3504, 7143, 5691, 8809, 8184, 4267, 4503, 4018, 11380, 697, 5265, 3793, 5703, 2958, 8630, 6662, 1832, 5803, 4938, 2407, 4780, 196, 3196, 1897, 8152, 4126, 8925, 12156, 1881, 2867, 1969, 10025, 517, 5175, 83, 4582, 11127, 5151, 5876, 10251, 9665, 5069, 5611, 4900, 10141, 11975, 4765, 10634, 7299, 10924, 9212, 6096, 12034, 2068, 11356, 9490, 6601, 10415, 6944, 8155, 3984, 5221, 6570, 4189, 5787, 4745, 7669, 4338, 8493, 8514, 3355, 3119, 12276, 12275, 7953, 12081, 3922, 10714, 8303, 11779, 6486, 3693, 2562, 7536, 10053, 6167, 10913, 9709, 5456, 4392, 729, 9071, 9579, 2188, 6655, 9649, 4842, 3581, 1529, 5881, 5124, 8420, 8111, 7423, 7108, 9430, 6891, 2227, 10936, 2158, 7235, 6420, 10068, 3624, 9736, 4174, 142, 11927, 9413, 2729, 4405, 5896, 600, 2217, 274, 4447, 6018, 3741, 9404, 6402, 5890, 779, 8054, 8765, 83, 7705, 1947, 11870, 6698, 6049, 4330, 8344, 10638, 1446, 4399, 12217, 6319, 10905, 8804, 1741, 3003, 5434, 3511, 9251, 1675, 3370, 5154, 192, 6322, 4096, 9074, 418, 8228, 4356, 3146, 2177, 1239, 8492, 11745, 8547, 8064, 7654, 11336, 212, 4497, 1701, 9871, 1688, 537, 6356, 2209, 6726, 11087, 6135, 9356, 2463, 9714, 1896, 6464, 1008, 8838, 2718, 8728, 7692, 5005, 9565, 9788, 2181, 7082, 8346, 10079, 5766, 11445, 7194, 9021, 6099, 7231, 937, 3916, 4382, 430, 1430, 10685, 2558, 10183, 2077, 10795, 1798, 5422, 8515, 997, 7099, 2606, 4272, 7233, 4325, 3025, 5569, 2338, 8466, 11528, 8450, 2012, 10104, 769, 3583, 8368, 9015, 6322, 9872, 1723, 12164, 1477, 12082, 4025, 2261, 5607, 3042, 9000, 6969, 1055, 10967, 8192, 9165, 7280, 6433, 11211, 7273, 8513, 6093, 10394, 3783, 10479, 7834, 2364, 3640, 1523, 3855, 9122, 2339, 6593, 11855, 3433, 6843, 10591, 8334, 3541, 1589, 3076, 3058, 4803, 9187, 2105, 1817, 1184, 10639, 3405, 9812, 669, 6879, 8700, 6590, 8597, 7742, 5291, 4017, 559, 10440, 9711, 6612, 5624, 7712, 10902, 4055, 4386, 4998, 5348, 10184, 12024, 11123, 440, 8127, 8747, 2725, 7353, 8245, 1408, 6889, 11161, 3200, 3052, 8593, 10249, 10015, 4905, 6270, 3945, 900, 10591, 3743, 11067, 7485, 307, 8266, 8863, 4659, 10768, 8863, 11746, 3850, 12279, 7016, 5526, 1327, 3104, 4176, 5148];

    let res = verify_distance(&nonce_msg, &sig, &pk_ntt_fmt);

    if res != 26821706 {
        panic!("Verify failure");
    };
}


// A struct to hold all the metrics we gather.
#[derive(Debug, Default)]
struct BenchMetrics {
    total_duration_ns: u128,
    total_cpu_cycles: u64,
    total_allocations: u64,
    peak_memory_bytes: u64,
}

/// A generic benchmarking function that takes any function closure.
fn benchmark<F>(name: &str, runs: u32, mut op: F)
where
    F: FnMut(),
{
    let mut metrics = BenchMetrics::default();

    // Warm-up run
    op();

    for _ in 0..runs {
        #[cfg(target_arch = "x86_64")]
        let start_cycles = unsafe { core::arch::x86_64::__rdtscp(&mut 0) };

        let start_time = Instant::now();

        #[cfg(feature = "bench")]
        let alloc_info = count_allocations(|| {
            op();
        });

        #[cfg(not(feature = "bench"))]
        op();

        let duration = start_time.elapsed();

        #[cfg(target_arch = "x86_64")]
        let end_cycles = unsafe { core::arch::x86_64::__rdtscp(&mut 0) };

        metrics.total_duration_ns += duration.as_nanos();

        #[cfg(feature = "bench")]
        {
            metrics.total_allocations += alloc_info.count_total;
            metrics.peak_memory_bytes = metrics.peak_memory_bytes.max(alloc_info.bytes_max);
        }

        #[cfg(target_arch = "x86_64")]
        {
            metrics.total_cpu_cycles += end_cycles - start_cycles;
        }
    }

    let total_duration_ms = metrics.total_duration_ns as f64 / 1_000_000.0;
    let avg_duration_ms = total_duration_ms / runs as f64;
    let ops_per_sec = if avg_duration_ms > 0.0 { 1_000.0 / avg_duration_ms } else { f64::INFINITY };

    println!("📊 {}", name);
    println!("Bench: {} runs, {:.3} ms total", runs.to_formatted_string(&Locale::en), total_duration_ms);
    println!("Avg per call:");
    println!("  - Time: {:.6} ms ({:.2} ops/sec)", avg_duration_ms, ops_per_sec);

    #[cfg(target_arch = "x86_64")]
    {
        let avg_cycles = if runs > 0 { metrics.total_cpu_cycles / runs as u64 } else { 0 };
        println!("  - CPU Cycles: {}", avg_cycles.to_formatted_string(&Locale::en));
    }

    #[cfg(feature = "bench")]
    {
        let avg_allocs = metrics.total_allocations as f64 / runs as f64;
        println!("  - Memory: {:.1} allocations, {} bytes peak usage", avg_allocs, metrics.peak_memory_bytes.to_formatted_string(&Locale::en));
    }
    #[cfg(not(feature = "bench"))]
    {
         println!("  - Memory: Not measured (run with '--features bench')");
    }
    println!();
}

fn main() {
    println!("--- Running Falcon512 Benchmarks ---");
    println!("--- Date: 2025-07-17 11:36:43 UTC ---");
    println!("--- User: wh173-c47 ---\n");

    // --- Plug your functions in here ---
    // These are dummy functions. Replace them with your actual falcon512 calls.
    benchmark("Falcon512 Verify NIST Test vector 0", 50_000, || {
        nist_test_verify_0();
    });
//     benchmark("Falcon512 Verify NIST Test vector 99", 50_000, || {
//          nist_test_verify_99();
//     });
}
